# Repository Documentation Cleanup Plan

> Goal: restore signal-to-noise in this repo without breaking the data pipeline.  
> Scope covers every Markdown/CSV “report” (both under `docs/` and scattered at the repo root) plus any helper scripts/tests accidentally generated by past agents.

---

## 1. Current State (what we learned from the tree)

| Area | Observations | Issues |
| --- | --- | --- |
| Root directory (`*.md`) | 100+ one-off reports (e.g. `COVERAGE_SUFFICIENCY_FINAL_REPORT.md`, `PNL_PIPELINE_FIRST_PRINCIPLES_ANALYSIS.md`) | No grouping, unclear freshness, clutters git diffs |
| `docs/` | Already has deep subfolders (`docs/features`, `docs/systems`, `docs/archive/...`) but many new files were dropped at the top level instead of in those buckets | Hard to find the “canonical” doc for a topic |
| `docs/archive/` | Contains historic reports but agents started storing *new* docs there as well | Archive vs. active blurred |
| Scripts/tests | Several helper scripts (parity checks, monitors) exist but there’s no check that documentation exists for each runnable script | Hard to know which docs are authoritative |

Takeaway: before deleting anything we need an inventory + migration plan.

---

## 2. Classification Method

For every Markdown/report we will assign one of three states:

| State | Definition | Action |
| --- | --- | --- |
| **Canonical** | Still accurate, referenced by current pipeline (e.g. STAR schema guide) | Move into the permanent structure listed below and refresh content |
| **Working Draft** | Partially correct or needed for short-term work (e.g. current ERC1155 analysis) | Keep in `docs/work-in-progress/` with an owner + expiry date |
| **Historical** | Superseded, read-only, or for context only | Move to `docs/archive/<yyyy-mm>/` with a short README |

We can auto-generate an inventory to seed this process:

```bash
npx tsx scripts/util/export-doc-inventory.ts > tmp/doc-inventory.csv
```

(_Script TBD_: loop through `**/*.md`, capture size, last commit date, suggested folder.)

---

## 3. Target Folder Structure

```
docs/
├── runbooks/         # How-to execute pipelines (ERC1155 backfill, nightly refresh, fact rebuild)
├── reference/        # Architecture diagrams, schemas, data dictionaries
├── reports/          # Executive summaries, investigations, post-mortems
├── playbooks/        # Decision trees, troubleshooting, incident response
├── work-in-progress/ # Temporary drafts (auto-prune or review weekly)
└── archive/          # Historical material (mirrors previous folders but read-only)
```

Mapping examples:

| Existing file | Destination | Notes |
| --- | --- | --- |
| `ERC1155_PIPELINE_COMPLETE_ANALYSIS.md` | `docs/reports/data/erc1155-pipeline.md` | Summarize, link to raw appendix in archive |
| `STAR_SCHEMA_IMPLEMENTATION_GUIDE.md` | `docs/runbooks/star-schema.md` | Canonical runbook for fact rebuild |
| `PNL_SYSTEM_FINAL_STATUS.md` | `docs/reports/pnl/2025-11-final-status.md` | Date-stamped |
| `DUNE_COMPARISON_ANALYSIS.md` | `docs/archive/2025-09/dune-comparison.md` | Historical only |

---

## 4. Execution Plan

1. **Inventory pass (day 1)**
   - Generate CSV (`path,last_modified,lines,category_guess`).
   - Sort by directory; manually tag top 50 highest-impact docs first.

2. **Migration waves (day 2-5)**
   - Wave 1: root `.md` files → classify/move.
   - Wave 2: `docs/` subfolders → ensure each matches the new taxonomy.
   - Wave 3: update references inside scripts/README to point to the new locations.

3. **Archive + README**
   - Each archive subfolder gets a concise README summarizing what’s inside and why it’s archived.

4. **Enforcement**
   - Add a lint script (`scripts/check-doc-locations.ts`) that fails CI when new Markdown lands outside the approved directories (unless it’s in `docs/work-in-progress`).
   - Update `CONTRIBUTING.md` to require choosing canonical destination before adding docs.

---

## 5. Enforcement via RULES.md (preferred guardrail)

Instead of cron jobs nagging us, we will gate every AI/agent interaction with a single canonical `RULES.md` at the repo root:

1. **RULES.md contents**
   - Folder taxonomy (from Section 3) with short explanations.
   - “Do/Do-not” bullets (e.g., “Do move superseded docs to `docs/archive/<date>`”, “Do not create new Markdown at repo root”).
   - Required checklists before writing new documentation (confirm canonical location, link related runbooks, tag owner/date).

2. **Agent workflow**
   - Each Claude terminal session must begin with “Read RULES.md and restate the key constraints you will follow.”
   - Prompts that spawn explore agents must embed the relevant excerpt from RULES.md so sub-agents inherit the structure.

3. **Human workflow**
   - PR template gets a checkbox: “I verified all new docs comply with RULES.md.”
   - Weekly review: skim git diff for RULES.md references to ensure it stays current with taxonomy changes.

This gives us a lightweight control point without automated deletion scripts.

---

## 6. Next Steps

1. Approve this taxonomy + workflow.
2. Build the `scripts/util/export-doc-inventory.ts` helper.
3. Start with the “root Markdown” wave (group of ~30 docs).  
4. Add RULES.md (once template is ready) and update PR template.  
5. Once reorganized, wire the nightly refresh doc into `docs/runbooks/` and delete the redundant copies.

This staged approach keeps functionality untouched while letting us slowly separate canonical docs from noise.
