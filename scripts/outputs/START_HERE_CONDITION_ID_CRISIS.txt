================================================================================
CONDITION_ID CRISIS: START HERE
================================================================================

You asked: "Where are the condition_ids? Can we reconstruct them?"

ANSWER: Yes. They're in the database and fully recoverable.

================================================================================
THE SITUATION (60 seconds)
================================================================================

PROBLEM:
  trades_raw has 159M rows
  Only 82M (51%) have condition_id
  Missing 77M (49%) prevent P&L calculations

GOOD NEWS:
  condition_ids ARE in the database
  Multiple 100%-populated mapping tables exist
  Recovery is safe, fast, low-risk

THE FIX:
  JOIN trades_raw with api_ctf_bridge
  Fill missing condition_ids from mapping tables
  Expected recovery: 51% → 75%+ in 2-3 hours

================================================================================
DOCUMENTS TO READ (In This Order)
================================================================================

1. CONDITION_ID_INVESTIGATION_SUMMARY.txt (5 min read)
   └─ What: Overview of findings
   └─ Why: Understand the scope
   └─ What to do: Pick your path

2. CONDITION_ID_QUICK_ACTION_PLAN.md (10 min read)
   └─ How: Step-by-step implementation
   └─ When: Timeline estimates
   └─ Success criteria: What "done" looks like

3. CONDITION_ID_INVESTIGATION_FINDINGS.md (20 min deep dive)
   └─ Details: Technical analysis
   └─ Evidence: Raw data from investigation
   └─ Options: All three paths explained

4. CONDITION_ID_RAW_DATA.txt (Reference)
   └─ Raw data: All table statistics
   └─ Validation: Audit results
   └─ Known unknowns: What we still need to check

================================================================================
QUICK DECISION TREE
================================================================================

Q: How much time do I have?

A: Less than 30 min
   → Read: CONDITION_ID_INVESTIGATION_SUMMARY.txt
   → Action: Decide on PATH A, B, or C

A: 1-2 hours
   → Read: CONDITION_ID_QUICK_ACTION_PLAN.md
   → Action: Start PATH A sample test

A: 4+ hours
   → Read: CONDITION_ID_INVESTIGATION_FINDINGS.md
   → Action: Full implementation of PATH A

================================================================================
THE THREE PATHS
================================================================================

PATH A: JOIN Reconstruction (RECOMMENDED) ⭐⭐⭐
  Time: 2-3 hours
  Risk: Very Low
  Complexity: Medium
  Success Rate: 95%+

  What: JOIN trades_raw with api_ctf_bridge
  Why: Fastest, safest, most reliable
  When: Do this first

PATH B: Use Alternate Tables (FALLBACK)
  Time: 4-6 hours
  Risk: Medium
  Complexity: High
  Success Rate: 85-90%

  What: Switch to trades_with_direction or trades_working
  Why: Already 100% populated
  When: If PATH A doesn't work

PATH C: API Backfill (LAST RESORT)
  Time: 8-16+ hours
  Risk: Very High
  Complexity: High
  Success Rate: 60-70%

  What: Call Polymarket API for missing IDs
  Why: Slowest, most expensive
  When: Only if A & B fail

RECOMMENDATION: Start with PATH A.

================================================================================
CRITICAL FACTS (Memorize These)
================================================================================

1. condition_ids are NOT lost
2. They exist in 21 tables with 100% population
3. Primary source: api_ctf_bridge (156,952 rows)
4. Secondary sources: condition_market_map, market_resolutions
5. Test wallet: 0x961b5ad4c66ec18d073c216054ddd42523336a1d
   - Currently: 5/15 trades with condition_id
   - After fix: Expected 15/15 (100%)

================================================================================
KEY NUMBERS
================================================================================

trades_raw Current State:
  Total rows: 159,574,259
  With condition_id: 82,138,586 (51%)
  Missing: 77,435,673 (49%)

Best Recovery Source (api_ctf_bridge):
  Total rows: 156,952
  With condition_id: 156,952 (100%)

Expected After PATH A:
  With condition_id: ~115M-120M (75%+)
  Missing: ~40M (25%)

Target After Completion:
  Goal: 85%+ populated
  Expected: 95%+ achievable

================================================================================
ACTION PLAN (DO THIS NOW)
================================================================================

STEP 1 (5 min): Read CONDITION_ID_INVESTIGATION_SUMMARY.txt
  → Understand the scope
  → Pick your path (A, B, or C)

STEP 2 (15 min): Read CONDITION_ID_QUICK_ACTION_PLAN.md
  → Get step-by-step guidance
  → Understand timeline

STEP 3 (Now): Make a decision
  → "I choose PATH A" → Start sample validation
  → "I choose PATH B" → Analyze row counts
  → "I choose PATH C" → Prepare API strategy

STEP 4 (Next): Execute your chosen path
  → See detailed instructions in CONDITION_ID_QUICK_ACTION_PLAN.md

================================================================================
FILES IN THIS INVESTIGATION
================================================================================

Documentation Files:
  ✓ START_HERE_CONDITION_ID_CRISIS.txt          ← You are here
  ✓ CONDITION_ID_INVESTIGATION_SUMMARY.txt      ← High-level overview
  ✓ CONDITION_ID_QUICK_ACTION_PLAN.md            ← Step-by-step guide
  ✓ CONDITION_ID_INVESTIGATION_FINDINGS.md      ← Technical deep dive
  ✓ CONDITION_ID_RAW_DATA.txt                    ← Raw statistics

Investigation Script:
  ✓ scripts/INVESTIGATE-condition-ids-storage.mjs ← Source of data

Next Step Scripts (To Be Created):
  - test-condition-id-join-sample.mjs           ← PATH A validation
  - reconstruct-condition-ids-join.mjs          ← PATH A full execution
  - analyze-alternate-tables.mjs                ← PATH B analysis

================================================================================
SUCCESS CRITERIA
================================================================================

You'll know it's working when:

✓ Can JOIN trades_raw with api_ctf_bridge successfully
✓ Sample test shows >70% recovery rate
✓ Test wallet 0x961b5ad4c66ec18d073c216054ddd42523336a1d has 15/15 trades with condition_id
✓ P&L calculations complete without "missing condition_id" errors
✓ Wallet resolution lookups succeed
✓ Dashboard shows correct PnL values

================================================================================
TIME ESTIMATES

If you choose PATH A:
  Sample test (30 min) → Full execution (60 min) → Validation (30 min) = 2 hours
  
If you choose PATH B:
  Analysis (1 hour) → Code changes (2-3 hours) → Testing (1-2 hours) = 4-6 hours

If you choose PATH C:
  Research (2 hours) → Implementation (6 hours) → Testing (2 hours) = 8-10 hours

================================================================================
NEXT STEP

Stop reading. Go read: CONDITION_ID_INVESTIGATION_SUMMARY.txt

Then decide: PATH A, B, or C?

Then execute.

You've got this. The data is there. Just need to connect the dots.

================================================================================
Questions? Reference:
  - Technical details: CONDITION_ID_INVESTIGATION_FINDINGS.md
  - Raw numbers: CONDITION_ID_RAW_DATA.txt
  - How-to guide: CONDITION_ID_QUICK_ACTION_PLAN.md
================================================================================
